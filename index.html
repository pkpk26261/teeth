<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Idensol Chroma - 專案管理</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🦷</text></svg>">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/ui-components.css">
  <link rel="stylesheet" href="css/mobile.css">
  <script src="js/auth.js" defer></script>
  <script src="js/mobile.js" defer></script>
</head>
<body class="dashboard-body">
  <!-- ===== 頂部導航列 ===== -->
  <header class="dashboard-header">
    <div class="header-left">
      <a href="/" class="logo">
        <span class="logo-icon">🦷</span>
        <span class="logo-text">Idensol Chroma</span>
      </a>
      <nav class="main-nav">
        <div class="nav-project-selector" id="navProjectSelector">
          <button class="nav-project-btn" id="navProjectBtn">
            <span class="nav-project-btn-icon">📂</span>
            <span class="nav-project-btn-text">選擇專案</span>
            <span class="nav-project-btn-arrow">▾</span>
            <span class="nav-project-btn-clear" title="取消選擇" style="display:none">✕</span>
          </button>
          <div class="nav-project-dropdown">
            <div class="nav-project-dropdown-header">
              <div class="nav-project-search-wrap">
                <svg class="nav-project-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input class="nav-project-search" type="text" placeholder="搜尋專案…" />
              </div>
            </div>
            <div class="nav-project-list"></div>
          </div>
        </div>
        <a href="#" class="nav-item active">我的項目</a>
        <div class="nav-dropdown" id="navRecipeTakeout">
          <button class="nav-item">食譜外帶 <span class="dropdown-arrow">▾</span></button>
          <div class="nav-dropdown-menu">
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub">輕量版 <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="recipe-dentin">1. 牙本質與釉質</button>
                <button class="nav-dropdown-item" data-feature="recipe-staining">2. 染色與釉面</button>
              </div>
            </div>
            <button class="nav-dropdown-item" data-feature="recipe-unified">一體化配方</button>
            <button class="nav-dropdown-item" data-feature="ai-color-guide">AI色階指南 <span class="nav-beta-badge">Beta</span></button>
          </div>
        </div>
        <div class="nav-dropdown" id="navMastery">
          <button class="nav-item">精通之道 <span class="dropdown-arrow">▾</span></button>
          <div class="nav-dropdown-menu nav-dropdown-menu-wide">
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub">模型製作 <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="mastery-resin">1. 樹酯配方</button>
                <button class="nav-dropdown-item" data-feature="mastery-3d-stain">2. 3D列印模型染色</button>
              </div>
            </div>
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub">全層堆疊 <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="mastery-fl-structure">1. 結構</button>
                <button class="nav-dropdown-item" data-feature="mastery-fl-wash">2. 清洗燒製</button>
                <button class="nav-dropdown-item" data-feature="mastery-fl-dentin">3. 牙本質</button>
                <button class="nav-dropdown-item" data-feature="mastery-fl-internal">4. 內部效果</button>
                <button class="nav-dropdown-item" data-feature="mastery-fl-staining">5. 染色工作室</button>
                <button class="nav-dropdown-item" data-feature="mastery-fl-enamel">6. 琺瑯質</button>
              </div>
            </div>
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub">微層堆疊 <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="mastery-ml-structure">1. 結構</button>
                <button class="nav-dropdown-item" data-feature="mastery-ml-staining">2. 染色工作室</button>
                <button class="nav-dropdown-item" data-feature="mastery-ml-internal">3. 內部效果</button>
                <button class="nav-dropdown-item" data-feature="mastery-ml-enamel">4. 琺瑯質</button>
              </div>
            </div>
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub">全單塊 <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="mastery-mono-structure">1. 結構</button>
                <button class="nav-dropdown-item" data-feature="mastery-mono-staining">2. 染色工作室</button>
              </div>
            </div>
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub"><span>牙齦 <span class="nav-beta-badge">Beta</span></span> <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="mastery-gingiva-stain">1. 染色</button>
                <button class="nav-dropdown-item" data-feature="mastery-gingiva-ceramic">2. 陶瓷</button>
              </div>
            </div>
            <div class="nav-dropdown-sub">
              <button class="nav-dropdown-item nav-has-sub">金屬烤瓷冠 (PFM) <span class="sub-arrow">▸</span></button>
              <div class="nav-sub-menu">
                <button class="nav-dropdown-item" data-feature="mastery-pfm-opaque">1. 不透明層</button>
                <button class="nav-dropdown-item" data-feature="mastery-pfm-opaque-stain">2. 不透明層染色</button>
                <button class="nav-dropdown-item" data-feature="mastery-pfm-dentin">3. 牙本質</button>
                <button class="nav-dropdown-item" data-feature="mastery-pfm-internal">4. 內部效果</button>
                <button class="nav-dropdown-item" data-feature="mastery-pfm-staining">5. 染色工作室</button>
                <button class="nav-dropdown-item" data-feature="mastery-pfm-enamel">6. 琺瑯質</button>
              </div>
            </div>
          </div>
        </div>
        <div class="nav-dropdown" id="navStaining">
          <button class="nav-item">染色工作室 <span class="dropdown-arrow">▾</span></button>
          <div class="nav-dropdown-menu">
            <button class="nav-dropdown-item" data-feature="stain-monolithic">整體式/色彩校正</button>
            <button class="nav-dropdown-item" data-feature="stain-shade-model">色調模型/樹樁色調</button>
            <button class="nav-dropdown-item" data-feature="stain-wash-fire">清洗燒製</button>
          </div>
        </div>
        <div class="nav-dropdown" id="navDigitalTryOn">
          <button class="nav-item">數位試戴 <span class="dropdown-arrow">▾</span></button>
          <div class="nav-dropdown-menu">
            <button class="nav-dropdown-item" data-feature="color-detection">色彩檢測</button>
            <button class="nav-dropdown-item" data-feature="ceramic-studio">陶瓷工作室</button>
          </div>
        </div>
      </nav>
    </div>
    <div class="header-right">
      <button class="theme-toggle" id="themeToggle" title="切換深色/淺色模式">
        <span class="icon-sun">☀️</span>
        <span class="icon-moon">🌙</span>
      </button>
      <div class="user-avatar" title="使用者選單">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      </div>
    </div>
  </header>

  <!-- ===== 主內容區 ===== -->
  <main class="dashboard-main">
    <div class="dashboard-container">
      <!-- 專案標題區 -->
      <div class="project-header">
        <h1 class="page-title">專案</h1>
        <button class="btn primary new-project-btn">
          <span class="plus-icon">+</span> 新專案
        </button>
      </div>

      <!-- 標籤頁與工具列 -->
      <div class="project-toolbar">
        <div class="tab-group">
          <button class="tab-btn active">我的專案</button>
          <button class="tab-btn">共享專案</button>
        </div>
        <div class="toolbar-actions">
          <div class="project-batch-bar" id="projectBatchBar">
            <span class="batch-selected-count" id="batchSelectedCount">1 已選擇</span>
            <button class="batch-action-btn" data-batch="open" id="batchOpenBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
              打開專案
            </button>
            <button class="batch-action-btn" data-batch="share" id="batchShareBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
              分享
            </button>
            <button class="batch-action-btn" data-batch="duplicate">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              複製
            </button>
            <button class="batch-action-btn danger" data-batch="delete">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
              刪除
            </button>
          </div>
          <div class="search-box-dash">
            <span class="search-icon">🔍</span>
            <input type="text" id="projectSearch" placeholder="搜尋">
            <span class="search-shortcut">⌘Q</span>
          </div>
          <button class="btn ghost icon-btn trash-btn" title="垃圾桶">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- 專案表格 -->
      <div class="project-table-wrapper">
        <table class="project-table">
          <thead>
            <tr>
              <th class="col-checkbox">
                <input type="checkbox" id="selectAll" class="checkbox">
              </th>
              <th class="col-name sortable">
                名稱 <span class="sort-icon">↓</span>
              </th>
              <th class="col-status sortable">
                狀態 <span class="sort-icon">↓</span>
              </th>
              <th class="col-dentist sortable">
                牙醫 <span class="sort-icon">↓</span>
              </th>
              <th class="col-shared sortable" id="colSharedHeader">
                共享對象 <span class="sort-icon">↓</span>
              </th>
              <th class="col-created sortable">
                建立時間 <span class="sort-icon">↓</span>
              </th>
              <th class="col-modified sortable">
                最後修改 <span class="sort-icon">↓</span>
              </th>
            </tr>
          </thead>
          <tbody id="projectTableBody">
            <!-- 專案列由 JavaScript 動態渲染 -->
          </tbody>
        </table>
      </div>

      <!-- 分頁 -->
      <div class="pagination">
        <div class="pagination-left">
          <label class="pagination-size-label">每頁顯示</label>
          <select class="pagination-size-select" id="pageSizeSelect">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <span class="pagination-size-label">筆</span>
        </div>
        <div class="pagination-right">
          <span class="pagination-info">0 of 0</span>
          <div class="pagination-btns">
            <button class="pagination-btn" id="paginationPrev" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <button class="pagination-btn" id="paginationNext" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 聊天按鈕 -->
  <button class="chat-fab" title="開啟聊天">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    <span>Chat</span>
  </button>

  <!-- ===== 新增/編輯專案 Modal ===== -->
  <div class="modal-overlay" id="projectModal">
    <div class="modal-dialog-box">
      <div class="modal-header-bar">
        <h3 class="modal-title" id="projectModalTitle">新增專案</h3>
        <button class="modal-close-btn" id="projectModalCloseBtn">&times;</button>
      </div>
      <form id="projectModalForm" class="modal-form">
        <input type="hidden" id="editProjectId" value="">
        <div class="form-field">
          <label for="modalProjectName">專案名稱 <span class="required-mark">*</span></label>
          <input type="text" id="modalProjectName" placeholder="請輸入專案名稱" required autocomplete="off">
        </div>
        <div class="form-field">
          <label for="modalDentistName">牙醫姓名</label>
          <input type="text" id="modalDentistName" placeholder="請輸入牙醫姓名" autocomplete="off">
        </div>
        <div class="form-field">
          <label for="modalDescription">描述</label>
          <textarea id="modalDescription" rows="3" placeholder="請輸入專案描述"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn ghost" id="projectModalCancelBtn">取消</button>
          <button type="submit" class="btn primary" id="projectModalSubmitBtn">建立專案</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== 回收站 Modal ===== -->
  <div class="modal-overlay" id="trashModal">
    <div class="modal-dialog-box trash-dialog">
      <div class="modal-header-bar">
        <h3 class="modal-title">🗑️ 回收站</h3>
        <button class="modal-close-btn" id="trashModalCloseBtn">&times;</button>
      </div>
      <div class="trash-content">
        <p class="trash-hint">已刪除的專案會保存在這裡，您可以選擇恢復或永久刪除。</p>
        <div class="trash-list" id="trashList">
          <div class="trash-empty">
            <span class="trash-empty-icon">🗑️</span>
            <span>回收站是空的</span>
          </div>
        </div>
      </div>
      <div class="modal-actions trash-actions">
        <button type="button" class="btn ghost" id="trashModalCloseBtn2">關閉</button>
        <button type="button" class="btn danger" id="emptyTrashBtn">清空回收站</button>
      </div>
    </div>
  </div>

  <!-- ===== 分享 Modal ===== -->
  <div class="modal-overlay" id="shareModal">
    <div class="modal-dialog-box share-dialog">
      <div class="modal-header-bar">
        <h3 class="modal-title" id="shareModalTitle">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: -3px; margin-right: 6px;"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
          分享專案
        </h3>
        <button class="modal-close-btn" id="shareModalCloseBtn">&times;</button>
      </div>
      <div class="share-modal-body">
        <!-- 搜尋使用者 -->
        <div class="share-search-section">
          <label class="share-label">新增分享對象</label>
          <div class="share-search-row">
            <div class="share-search-input-wrap">
              <svg class="share-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              <input type="text" id="shareUserSearch" class="share-search-input" placeholder="輸入帳號或姓名搜尋..." autocomplete="off">
            </div>
            <select id="sharePermission" class="share-permission-select">
              <option value="view">僅檢視</option>
              <option value="edit">可編輯</option>
            </select>
          </div>
          <!-- 搜尋結果下拉 -->
          <div class="share-search-results" id="shareSearchResults"></div>
        </div>

        <!-- 目前分享清單 -->
        <div class="share-list-section">
          <label class="share-label">已分享的對象</label>
          <div class="share-current-list" id="shareCurrentList">
            <div class="share-empty-state">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5" opacity="0.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              <span>尚未分享給任何人</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-actions share-modal-actions">
        <button type="button" class="btn ghost" id="shareModalCancelBtn">關閉</button>
      </div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script src="js/ui-components.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>
